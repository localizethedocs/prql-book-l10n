<!DOCTYPE HTML>
<html lang="en_US" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Relations - PRQL language book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="../ltd-provenance.js"></script>
        <script type="text/javascript" src="../ltd-current.js"></script>
        <script type="text/javascript" src="../../../ltd-config.js"></script>
        <script type="text/javascript" src="../../../ltd-flyout.js"></script>

        <meta name="description" content="Modern language for transforming data — a simple, powerful, pipelined SQL replacement">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../comparison-table.css">
        <link rel="stylesheet" href="../mdbook-admonish.css">
        <link rel="stylesheet" href=".././mdbook-admonish.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">PRQL language book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/PRQL/prql" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="relations"><a class="header" href="#relations">Relations</a></h1>
<p>PRQL is designed on top of <em>relational algebra</em>, which is the established data
model used by modern SQL databases. A <em>relation</em> has a rigid mathematical
definition, which can be simplified to “a table of data”. For example, the
<code>invoices</code> table from the Chinook database
(<a href="https://github.com/lerocha/chinook-database">https://github.com/lerocha/chinook-database</a>)
looks like this:</p>
<div class="table-wrapper"><table><thead><tr><th>invoice_id</th><th>customer_id</th><th>billing_city</th><th style="text-align: center"><em>other columns</em></th><th>total</th></tr></thead><tbody>
<tr><td>1</td><td>2</td><td>Stuttgart</td><td style="text-align: center">…</td><td>1.98</td></tr>
<tr><td>2</td><td>4</td><td>Oslo</td><td style="text-align: center">…</td><td>3.96</td></tr>
<tr><td>3</td><td>8</td><td>Brussels</td><td style="text-align: center">…</td><td>5.94</td></tr>
<tr><td>4</td><td>14</td><td>Edmonton</td><td style="text-align: center">…</td><td>8.91</td></tr>
<tr><td>5</td><td>23</td><td>Boston</td><td style="text-align: center">…</td><td>13.86</td></tr>
<tr><td>6</td><td>37</td><td>Frankfurt</td><td style="text-align: center">…</td><td>0.99</td></tr>
</tbody></table>
</div>
<p>A relation is composed of rows. Each row in a relation contains a value for each
of the relation’s columns. Each column in a relation has an unique name and a
designated data type. The table above is a relation, and has columns named
<code>invoice_id</code>and <code>customer_id</code> each with a data type of “integer number”, a
<code>billing_city</code> column with a data type of “text”, several other columns, and a
<code>total</code> column that contains floating-point numbers.</p>
<h2 id="queries"><a class="header" href="#queries">Queries</a></h2>
<p>The main purpose of PRQL is to build queries that combine and transform data
from relations such as the <code>invoices</code> table above. Here is the most basic query:</p>
<pre><code class="language-prql no-eval">from invoices
</code></pre>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note"></a>
</div>
<div>
<p>Try each of these examples here in the
<a href="https://prql-lang.org/playground/">Playground.</a> Enter the query on the
left-hand side, and click <strong>output.arrow</strong> in the right-hand side to see the
result.</p>
</div>
</div>
<p>The result of the query above is not terribly interesting, it’s just the same
relation as before.</p>
<h3 id="select-transform"><a class="header" href="#select-transform"><code>select</code> transform</a></h3>
<p>The <code>select</code> function picks the columns to pass through based on a list and
discards all others. Formally, that list is a <em>tuple</em> of comma-separated
expressions wrapped in <code>{ ... }</code>.</p>
<p>Suppose we only need the <code>order_id</code> and <code>total</code> columns. Use <code>select</code> to choose
the columns to pass through. <em>(Try it in the
<a href="https://prql-lang.org/playground/">Playground.</a>)</em></p>
<pre><code class="language-prql no-eval">from invoices
select { order_id, total }
</code></pre>
<p>We can write the items in the tuple on one or several lines: trailing commas are
ignored. In addition, we can assign any of the expressions to a <em>variable</em> that
becomes the name of the resulting column in the SQL output.</p>
<pre><code class="language-prql no-eval">from invoices
select {
  OrderID = invoice_id,
  Total = total,
}
</code></pre>
<p>This is the same query as above, rewritten on multiple lines, and assigning
<code>OrderID</code> and <code>Total</code> names to the columns.</p>
<p>Once we <code>select</code> certain columns, subsequent transforms will have access only to
those columns named in the tuple.</p>
<h3 id="derive-transform"><a class="header" href="#derive-transform"><code>derive</code> transform</a></h3>
<p>To add columns to a relation, we can use <code>derive</code> function. Let’s define a new
column for Value Added Tax, set at 19% of the invoice total.</p>
<pre><code class="language-prql no-eval">from invoices
derive { VAT = total * 0.19 }
</code></pre>
<!-- todo: make sure that the new column is unnamed -->
<p>The value of the new column can be a constant (such as a number or a string), or
can be computed from the value of an existing column. Note that the value of the
new column is assigned the name <code>VAT</code>.</p>
<h3 id="join-transform"><a class="header" href="#join-transform"><code>join</code> transform</a></h3>
<p>The <code>join</code> transform also adds columns to the relation by combining the rows
from two relations “side by side”. To determine which rows from each relation
should be joined, <code>join</code> has match criteria, written in <code>( ... )</code>.</p>
<pre><code class="language-prql no-eval">from invoices
join customers ( ==customer_id )
</code></pre>
<p>This example “connects” the customer information from the <code>customers</code> relation
with the information from the <code>invoices</code> relation, using identical values of the
<code>customer_id</code> column from each relation to match the rows.</p>
<p>It is frequently useful to assign an alias to both relations being joined
together so that each relation’s columns can be referred to uniquely.</p>
<pre><code class="language-prql no-eval">from inv=invoices
join cust=customers ( ==customer_id )
</code></pre>
<p>In the example above, the alias <code>inv</code> represents the <code>invoices</code> relation and
<code>cust</code> represents the <code>customers</code> relation. It then becomes possible to refer to
<code>inv.billing_city</code> and <code>cust.last_name</code> unambiguously.</p>
<h3 id="summary"><a class="header" href="#summary">Summary</a></h3>
<p>PRQL manipulates relations (tables) of data. The <code>derive</code>, <code>select</code>, and <code>join</code>
transforms change the number of columns in a table. The first two never affect
the number of rows in a table. <code>join</code> may change the number of rows, depending
on the variation chosen.</p>
<p>This final example combines the above into a single query. It illustrates <em>a
pipeline</em> - the fundamental basis of PRQL. We simply add new lines (transforms)
at the end of the query. Each transform modifies the relation produced by the
statement above to produce the desired result.</p>
<pre><code class="language-prql no-eval">from inv=invoices
join cust=customers (==customer_id)
derive { VAT = inv.total * 0.19 }
select {
  OrderID = inv.invoice_id,
  CustomerName = cust.last_name,
  Total = inv.total,
  VAT,
}
</code></pre>
<!-- PRQL uses the data from... _Where does our data come from? Do we use some canonical version?_ -->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../overview.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../tutorial/filtering.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../overview.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../tutorial/filtering.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../highlight-prql.js"></script>



    </div>
    </body>
</html>
